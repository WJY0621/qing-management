# 防止重复注册计划

用户希望在注册时，如果邮箱已经被占用，能够明确提示“该邮箱已被注册”。

目前 Supabase 的 `signUp` 方法在默认配置下（Email confirmations enabled），如果用户注册一个已存在的邮箱，出于安全隐私保护（Security through obscurity），它通常**不会**直接报错说“邮箱已存在”，而是会假装发送了一封确认邮件，或者什么都不做。这会导致前端无法判断是否重复注册。

为了实现用户想要的效果，我们需要在调用 `signUp` 之前，或者通过捕获 `signUp` 的特定错误（如果 Supabase 配置允许暴露）来处理。但最稳妥的方式通常是：
1.  **捕获特定错误**：如果 Supabase 返回 `User already registered` 错误。
2.  **前端优化**：在 `Register.tsx` 中捕获异常，并翻译成中文提示。

根据 Supabase 的文档和常见行为：
*   如果关闭了 "Confirm email"（不需要邮箱验证），重复注册会直接报错。
*   如果开启了邮箱验证，Supabase 默认为了防止枚举攻击，可能不会报错。
*   **但是**，通常在 `authService.ts` 里，如果 `supabase.auth.signUp` 返回 `error`，我们可以捕获它。如果返回的 `error.message` 是 "User already registered"，我们就提示用户。

**实施步骤：**

1.  **修改 `src/pages/Register.tsx`**:
    *   在 `handleRegister` 函数的 `catch` 块中，检查错误信息。
    *   如果错误信息包含 "already registered" 或类似关键词，设置 `error` 状态为 "该邮箱已被注册，请直接登录"。

2.  **修改 `src/services/authService.ts` (可选)**:
    *   目前 `authService.ts` 只是简单的 `throw error`。我们可以保持它不变，让 UI 层去处理具体的错误文案。

**注意**：
如果用户的 Supabase 项目配置了“发送确认邮件”，那么对于已存在的用户，`signUp` 可能**不会抛出错误**，而是返回一个空的 session 或 user，且不会发送邮件（或者发送一封“有人尝试用你的邮箱注册”的邮件）。
*   在这种情况下，要检测邮箱是否被占用，通常没有直接的 API（为了安全）。
*   但我们可以尝试**利用 `signIn` 检查**？不，这需要密码。
*   **最通用的做法**：我们先假设 `signUp` 会报错（这是最常见的情况，特别是开发模式）。如果它不报错但用户收不到邮件，那就是 Supabase 的安全设置导致的，这时候我们只能提示“如果邮箱未被注册，您将收到确认邮件”。
*   **然而**，用户明确要求“提示用户该邮箱已被注册”。这通常意味着我们需要捕获那个 400 错误。在大多数 Supabase 设置中，重复注册**会**返回错误（Error: User already registered）。

我将重点修改前端 `Register.tsx` 的错误处理逻辑。

## 计划
1.  修改 `src/pages/Register.tsx`，在 `handleRegister` 的 `catch` 块中添加对 `User already registered` 错误的判断。
2.  将其翻译为中文提示："该邮箱已被注册，请直接登录"。

不需要修改后端或 SQL，这纯粹是前端对 API 错误信息的处理。